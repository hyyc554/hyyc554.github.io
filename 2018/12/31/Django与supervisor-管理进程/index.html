<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />










  <meta name="baidu-site-verification" content="A1iPgcxNQu" />







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Django,Linux," />










<meta name="description" content="1、前言在Django项目中，我们需要用到一些独立于Django框架外的脚本。这样一些脚本可能需要独立的持续运行，且具有很强的可维护性，这个时候supervisor就可以排上用场了。">
<meta name="keywords" content="Django,Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Django与supervisor 管理进程">
<meta property="og:url" content="https://hyyc554.github.io/2018/12/31/Django与supervisor-管理进程/index.html">
<meta property="og:site_name" content="YoungCe的笔记">
<meta property="og:description" content="1、前言在Django项目中，我们需要用到一些独立于Django框架外的脚本。这样一些脚本可能需要独立的持续运行，且具有很强的可维护性，这个时候supervisor就可以排上用场了。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/d126accegy1fyq9bijxgvj206h08hjrr.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/d126accegy1fyqajnbn72j20me066t8x.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/d126accegy1fyqaemp03ej20lv061t8y.jpg">
<meta property="og:updated_time" content="2018-12-31T14:35:53.758Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Django与supervisor 管理进程">
<meta name="twitter:description" content="1、前言在Django项目中，我们需要用到一些独立于Django框架外的脚本。这样一些脚本可能需要独立的持续运行，且具有很强的可维护性，这个时候supervisor就可以排上用场了。">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/d126accegy1fyq9bijxgvj206h08hjrr.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://hyyc554.github.io/2018/12/31/Django与supervisor-管理进程/"/>





  <title>Django与supervisor 管理进程 | YoungCe的笔记</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YoungCe的笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">献给所有爱我的人</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hyyc554.github.io/2018/12/31/Django与supervisor-管理进程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YoungCe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/123cool.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YoungCe的笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Django与supervisor 管理进程</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-31T22:32:35+08:00">
                2018-12-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv">本文总阅读量
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><p>在Django项目中，我们需要用到一些独立于Django框架外的脚本。这样一些脚本可能需要独立的持续运行，且具有很强的可维护性，这个时候supervisor就可以排上用场了。</p>
<p><img src="https://ws1.sinaimg.cn/large/d126accegy1fyq9bijxgvj206h08hjrr.jpg" alt=""></p>
<a id="more"></a>
<ul>
<li><p>基于python编写，安装方便</p>
</li>
<li><p>进程管理工具，可以很方便的对用户定义的进程进行启动，关闭，重启，并且对意外关闭的进程进行重启 ，只需要简单的配置一下即可，且有web端，状态、日志查看清晰明了。</p>
</li>
<li><p>组成部分 </p>
<ul>
<li>supervisord[服务端，所以要通过这个来启动它]</li>
<li>supervisorctl[客户端，可以来执行stop等命令]</li>
</ul>
</li>
<li><p>官方文档地址：</p>
<p><a href="http://supervisord.org/" target="_blank" rel="noopener">http://supervisord.org/</a></p>
</li>
</ul>
<h2 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h2><p>直接使用pip进行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install supervisor</span><br></pre></td></tr></table></figure>
<h2 id="3、使用说明"><a href="#3、使用说明" class="headerlink" title="3、使用说明"></a>3、使用说明</h2><p>使用supervisor很简单，只需要修改一些配置文件，就可以使用了。</p>
<h4 id="3-1-查看默认配置"><a href="#3-1-查看默认配置" class="headerlink" title="3.1 查看默认配置"></a>3.1 查看默认配置</h4><p>运行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo_supervisord_conf</span><br></pre></td></tr></table></figure>
<p>即可看到默认配置情况，但是一般情况下，我们都不要去修改默认的配置，而是将默认配置重定向到另外的文件中，不同的进程运用不同的配置文件去对默认文件进行复写即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo_supervisord_conf &gt; /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>默认配置说明</p>
<blockquote>
<p>默认的配置文件是下面这样的，但是这里有个坑需要注意，supervisord.pid 以及 supervisor.sock 是放在 /tmp 目录下，但是 /tmp 目录是存放临时文件，里面的文件是会被 Linux 系统删除的，一旦这些文件丢失，就无法再通过 supervisorctl 来执行 restart 和 stop 命令了，将只会得到 unix:///tmp/supervisor.sock 不存在的错误 。</p>
</blockquote>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[unix_http_server]</span></span><br><span class="line"><span class="comment">;file=/tmp/supervisor.sock   ; (the path to the socket file)</span></span><br><span class="line"><span class="comment">;建议修改为 /var/run 目录，避免被系统删除</span></span><br><span class="line"><span class="attr">file</span>=/var/run/supervisor.sock   ; (the path to the socket file)</span><br><span class="line"><span class="comment">;chmod=0700                 ; socket file mode (default 0700)</span></span><br><span class="line"><span class="comment">;chown=nobody:nogroup       ; socket file uid:gid owner</span></span><br><span class="line"><span class="comment">;username=user              ; (default is no username (open server))</span></span><br><span class="line"><span class="comment">;password=123               ; (default is no password (open server))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;[inet_http_server]         ; inet (TCP) server disabled by default</span></span><br><span class="line"><span class="comment">;port=127.0.0.1:9001        ; (ip_address:port specifier, *:port for ;all iface)</span></span><br><span class="line"><span class="comment">;username=user              ; (default is no username (open server))</span></span><br><span class="line"><span class="comment">;password=123               ; (default is no password (open server))</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="section">[supervisord]</span></span><br><span class="line"><span class="comment">;logfile=/tmp/supervisord.log ; 日志文件(main log file;default $CWD/supervisord.log)</span></span><br><span class="line"><span class="comment">;建议修改为 /var/log 目录，避免被系统删除</span></span><br><span class="line"><span class="attr">logfile</span>=/var/log/supervisor/supervisord.log ; (main log file;default <span class="variable">$CWD</span>/supervisord.log)</span><br><span class="line"><span class="attr">logfile_maxbytes</span>=<span class="number">50</span>MB        ; 日志文件大小(max main logfile bytes b4 rotation;default <span class="number">50</span>MB)</span><br><span class="line"><span class="attr">logfile_backups</span>=<span class="number">10</span>           ; 日志文件保留备份数量(num of main logfile rotation backups;default <span class="number">10</span>)</span><br><span class="line"><span class="attr">loglevel</span>=info                ; 日志级别(log level;default info; others: debug,warn,trace)</span><br><span class="line"><span class="comment">;pidfile=/tmp/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span></span><br><span class="line"><span class="comment">;建议修改为 /var/run 目录，避免被系统删除</span></span><br><span class="line"><span class="attr">pidfile</span>=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span><br><span class="line"><span class="comment">;设置启动supervisord的用户，一般情况下不要轻易用root用户来启动，除非你真的确定要这么做</span></span><br><span class="line"><span class="comment">;user=chrism                 ; (default is current user, required if root)</span></span><br><span class="line"><span class="attr">nodaemon</span>=<span class="literal">false</span>               ; (start in foreground if <span class="literal">true</span>;default <span class="literal">false</span>)</span><br><span class="line"><span class="attr">minfds</span>=<span class="number">1024</span>                  ; (min. avail startup file descriptors;default <span class="number">1024</span>)</span><br><span class="line"><span class="attr">minprocs</span>=<span class="number">200</span>                 ; (min. avail process descriptors;default <span class="number">200</span>)</span><br><span class="line"><span class="comment">;umask=022                   ; (process file creation umask;default 022)</span></span><br><span class="line"><span class="comment">;identifier=supervisor       ; (supervisord identifier, default is 'supervisor')</span></span><br><span class="line"><span class="comment">;directory=/tmp              ; (default is not to cd during start)</span></span><br><span class="line"><span class="comment">;nocleanup=true              ; (don't clean up tempfiles at start;default false)</span></span><br><span class="line"><span class="comment">;childlogdir=/tmp            ; ('AUTO' child log dir, default $TEMP)</span></span><br><span class="line"><span class="comment">;environment=KEY="value"     ; (key value pairs to add to environment)</span></span><br><span class="line"><span class="comment">;strip_ansi=false            ; (strip ansi escape codes in logs; def. false)</span></span><br><span class="line"></span><br><span class="line"><span class="section">[unix_http_server]</span></span><br><span class="line"><span class="attr">file</span>=/tmp/supervisor.sock   ; (the path to the socket file)</span><br><span class="line"><span class="comment">;chmod=0700                 ; socket file mode (default 0700)</span></span><br><span class="line"><span class="comment">;chown=nobody:nogroup       ; socket file uid:gid owner</span></span><br><span class="line"><span class="comment">;username=user              ; (default is no username (open server))</span></span><br><span class="line"><span class="comment">;password=123               ; (default is no password (open server))</span></span><br><span class="line"></span><br><span class="line"><span class="section">[supervisorctl]</span></span><br><span class="line"><span class="comment">; 必须和'unix_http_server'里面的设定匹配</span></span><br><span class="line"><span class="comment">;serverurl=unix:///tmp/supervisor.sock ; use a unix:// URL  for a unix socket</span></span><br><span class="line"><span class="comment">;建议修改为 /var/run 目录，避免被系统删除</span></span><br><span class="line"><span class="attr">serverurl</span>=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket</span><br><span class="line"><span class="comment">;serverurl=http://127.0.0.1:9001 ; use an http:// url to specify an inet socket</span></span><br><span class="line"><span class="comment">;username=chris              ; should be same as http_username if set</span></span><br><span class="line"><span class="comment">;password=123                ; should be same as http_password if set</span></span><br><span class="line"></span><br><span class="line">。。。</span><br><span class="line"></span><br><span class="line"><span class="section">[include]</span></span><br><span class="line"><span class="attr">files</span> = /etc/supervisor/*.conf</span><br></pre></td></tr></table></figure>
<p>配置文件都有说明，且很简单，就不做多的描述了，在上面有一些建议修改的目录，若做了修改，则应先创建这些文件，需要注意权限问题，很多错误都是没有权限造成的。</p>
<h4 id="3-2-启动服务端"><a href="#3-2-启动服务端" class="headerlink" title="3.2 启动服务端"></a>3.2 启动服务端</h4><p>现在，让我们来启动supervisor服务。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>查看supervisord 是否运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps aux|grep superviosrd</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">output:xxxx   82039      1  0 11:22 ?        00:00:00 /usr/local/bin/python /usr/local/bin/supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<h4 id="3-2-项目配置及运行"><a href="#3-2-项目配置及运行" class="headerlink" title="3.2 项目配置及运行"></a>3.2 项目配置及运行</h4><p>上面我们已经把 supervisrod 运行起来了，现在可以添加我们要管理的进程的配置文件。可以把所有配置项都写到 supervisord.conf 文件里，但并不推荐这样做，而是通过 include 的方式把不同的程序（组）写到不同的配置文件里，对，就是默认配置中的最后的那个include。下面来对项目进行简单的配置。<br>假设我们把项目配置文件放在这个目录中:<code>/etc/supervisor/</code><br>则我们需要修改<code>/etc/supervisord.conf</code> 中的include为：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[include]</span></span><br><span class="line"><span class="attr">files</span> = /etc/supervisor/*.conf</span><br></pre></td></tr></table></figure>
<p>测试py文件：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    print(<span class="string">'i am ok'</span>)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>以下为配置文件目录<code>/etc/supervisor/test.conf</code>：</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[program:testpy]</span></span><br><span class="line"><span class="attr">command</span>=python test.py              ; the program (relative uses PATH, can take args)</span><br><span class="line"><span class="comment">;process_name=%(program_name)s ; process_name expr (default %(program_name)s)</span></span><br><span class="line"><span class="comment">;numprocs=1                    ; number of processes copies to start (def 1)</span></span><br><span class="line"><span class="attr">directory</span>=/root/myporject/               ; directory to cwd to before exec (def <span class="literal">no</span> cwd)</span><br><span class="line"><span class="comment">;umask=022                     ; umask for process (default None)</span></span><br><span class="line"><span class="attr">priority</span>=<span class="number">999</span>                  ; the relative start priority (default <span class="number">999</span>)</span><br><span class="line"><span class="attr">startsecs</span> = <span class="number">5</span>        ; 启动 <span class="number">5</span> 秒后没有异常退出，就当作已经正常启动了</span><br><span class="line"><span class="attr">autorestart</span> = <span class="literal">true</span>   ; 程序异常退出后自动重启</span><br><span class="line"><span class="attr">startretries</span> = <span class="number">3</span>     ; 启动失败自动重试次数，默认是 <span class="number">3</span></span><br><span class="line"><span class="attr">stdout_logfile</span> = /root/myporject/supervisor.log</span><br></pre></td></tr></table></figure>
<p>配置完成以后，即可运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>查看运行状态</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# supervisorctl status</span><br><span class="line">testpy                           RUNNING   pid 2391, uptime 0:00:54</span><br></pre></td></tr></table></figure>
<p>打开浏览器，输入127.0.0.9001,输入用户名与密码（如果配置文件中inet_http_server中作了设置），可以看到下面这个界面：</p>
<p><img src="https://ws1.sinaimg.cn/large/d126accegy1fyqajnbn72j20me066t8x.jpg" alt=""></p>
<h4 id="3-3-使用supervisorctl"><a href="#3-3-使用supervisorctl" class="headerlink" title="3.3 使用supervisorctl"></a>3.3 使用supervisorctl</h4><p>在启动服务之后，运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">supervisorctl -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>或者直接<code>supervisorctl</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# supervisorctl</span><br><span class="line">testpy                           RUNNING   pid 2391, uptime 0:01:45</span><br></pre></td></tr></table></figure>
<p>若成功，则会进入supervisorctl的shell界面，有以下方法：</p>
<ul>
<li>status                   # 查看程序状态</li>
<li>stop testpy               # 关闭 testpy 程序</li>
<li>start testpy               # 启动 testpy 程序</li>
<li>restart testpy           # 重启 testpy 程序</li>
<li>reread                      ＃ 读取有更新（增加）的配置文件，不会启动新添加的程序</li>
<li>update                     ＃ 重启配置文件修改过的程序</li>
</ul>
<p>执行相关操作后，可以在web端看到具体的变化情况，如stop 程序</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stop testpy</span><br></pre></td></tr></table></figure>
<p><img src="https://ws1.sinaimg.cn/large/d126accegy1fyqaemp03ej20lv061t8y.jpg" alt=""></p>
<p>其实，也可以不使用supervisorctl shell界面，而在bash终端运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ supervisorctl status</span><br><span class="line">$ supervisorctl stop usercenter</span><br><span class="line">$ supervisorctl start usercenter</span><br><span class="line">$ supervisorctl restart usercenter</span><br><span class="line">$ supervisorctl reread</span><br><span class="line">$ supervisorctl update</span><br></pre></td></tr></table></figure>
<h4 id="3-4-多个进程管理"><a href="#3-4-多个进程管理" class="headerlink" title="3.4 多个进程管理"></a>3.4 多个进程管理</h4><p>按照官方文档的定义，一个 [program:x] 实际上是表示一组相同特征或同类的进程组，也就是说一个 [program:x] 可以启动多个进程。这组进程的成员是通过 numprocs 和 process_name 这两个参数来确定的，这句话什么意思呢，我们来看这个例子。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">; 设置进程的名称，使用 supervisorctl 来管理进程时需要使用该进程名</span><br><span class="line">[program:foo] </span><br><span class="line"></span><br><span class="line">; 可以在 command 这里用 python 表达式传递不同的参数给每个进程</span><br><span class="line">command=python server.py --port=90%(process_num)02d</span><br><span class="line"></span><br><span class="line">directory=/home/python/tornado_server ; 执行 command 之前，先切换到工作目录</span><br><span class="line"></span><br><span class="line">; 若 numprocs 不为1，process_name 的表达式中一定要包含 process_num 来区分不同的进程</span><br><span class="line">numprocs=2                   </span><br><span class="line">process_name=%(program_name)s_%(process_num)02d; </span><br><span class="line"></span><br><span class="line">user=oxygen                 ; 使用 oxygen 用户来启动该进程</span><br><span class="line"></span><br><span class="line">autorestart=true  ; 程序崩溃时自动重启</span><br><span class="line"></span><br><span class="line">redirect_stderr=true      ; 重定向输出的日志</span><br><span class="line"></span><br><span class="line">stdout_logfile = /var/log/supervisord/</span><br><span class="line">tornado_server.log</span><br><span class="line">loglevel=info</span><br></pre></td></tr></table></figure>
<p>上面这个例子会启动两个进程，process_name 分别为 foo:foo_01 和 foo:foo_02。通过这样一种方式，就可以用一个 [program:x] 配置项，来启动一组非常类似的进程。<br> 更详细配置，点击<a href="https://link.jianshu.com?t=http://supervisord.org/configuration.html#program-x-section-settings" target="_blank" rel="noopener">这里</a></p>
<p>Supervisor 同时还提供了另外一种进程组的管理方式，通过这种方式，可以使用 supervisorctl 命令来管理一组进程。跟 [program:x] 的进程组不同的是，这里的进程是一个个的 [program:x] 。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[group:thegroupname]</span><br><span class="line">programs=progname1,progname2  ; each refers to &apos;x&apos; in [program:x] definitions</span><br><span class="line">priority=999                  ; the relative start priority (default 999)</span><br></pre></td></tr></table></figure>
<p>当添加了上述配置后，progname1 和 progname2 的进程名就会变成 thegroupname:progname1 和 thegroupname:progname2 以后就要用这个名字来管理进程了，而不是之前的 progname1。</p>
<p>以后执行 supervisorctl stop thegroupname: 就能同时结束 progname1 和 progname2，执行 supervisorctl stop thegroupname:progname1 就能结束 progname1。</p>
<h2 id="4-结尾"><a href="#4-结尾" class="headerlink" title="4. 结尾"></a>4. 结尾</h2><p>实际上，默认情况下，supervisored 也是一个进程，最理想的的情况应该是将其安装为系统服务，安装方法可以参考<a href="https://link.jianshu.com?t=http://serverfault.com/questions/96499/how-to-automatically-start-supervisord-on-linux-ubuntu" target="_blank" rel="noopener">这里</a>,安装脚本参考<a href="https://link.jianshu.com?t=https://github.com/Supervisor/initscripts" target="_blank" rel="noopener">这里</a>,由于没有做具体的实验，此处不展开说明。</p>
<p>其实还有一个简单的方法，因为 Linux 在启动的时候会执行 /etc/rc.local 里面的脚本，所以只要在这里添加执行命令就可以</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 如果是 Ubuntu 添加以下内容</span><br><span class="line">/usr/local/bin/supervisord -c /etc/supervisord.conf</span><br><span class="line"></span><br><span class="line"># 如果是 Centos 添加以下内容</span><br><span class="line">/usr/bin/supervisord -c /etc/supervisord.conf</span><br></pre></td></tr></table></figure>
<p>以上内容需要添加在 exit 命令前，而且由于在执行 rc.local 脚本时，PATH 环境变量未全部初始化，因此命令需要使用绝对路径。</p>
<p>在添加前，先在终端测试一下命令是否能正常执行，如果找不到 supervisord，可以用如下命令找到</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo find / -name supervisord</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line">/usr/local/bin/supervisord</span><br></pre></td></tr></table></figure>
<h2 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h2><blockquote>
<p>这段日子真的很难    <a href="https://www.jianshu.com/p/bf2b3f4dec73" target="_blank" rel="noopener">https://www.jianshu.com/p/bf2b3f4dec73</a></p>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Django/" rel="tag"># Django</a>
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/31/我的2019计划/" rel="next" title="我的2019计划">
                <i class="fa fa-chevron-left"></i> 我的2019计划
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/06/流畅的Python读书笔记（二）/" rel="prev" title="流畅的Python读书笔记（二）">
                流畅的Python读书笔记（二） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "1",
        "bdMiniList": false,
        "bdPic": ""
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      },
      "slide": {
        "bdImg": "5",
        "bdPos": "left",
        "bdTop": "100"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNzIxMi8xMzc0Ng=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/123cool.png"
                alt="YoungCe" />
            
              <p class="site-author-name" itemprop="name">YoungCe</p>
              <p class="site-description motion-element" itemprop="description">一个学习者</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/hyyc554" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:hyc554@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1、前言"><span class="nav-number">1.</span> <span class="nav-text">1、前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2、安装"><span class="nav-number">2.</span> <span class="nav-text">2、安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3、使用说明"><span class="nav-number">3.</span> <span class="nav-text">3、使用说明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-查看默认配置"><span class="nav-number">3.0.1.</span> <span class="nav-text">3.1 查看默认配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-启动服务端"><span class="nav-number">3.0.2.</span> <span class="nav-text">3.2 启动服务端</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-项目配置及运行"><span class="nav-number">3.0.3.</span> <span class="nav-text">3.2 项目配置及运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-使用supervisorctl"><span class="nav-number">3.0.4.</span> <span class="nav-text">3.3 使用supervisorctl</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-多个进程管理"><span class="nav-number">3.0.5.</span> <span class="nav-text">3.4 多个进程管理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-结尾"><span class="nav-number">4.</span> <span class="nav-text">4. 结尾</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料："><span class="nav-number">5.</span> <span class="nav-text">参考资料：</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YoungCe</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
    <span class="site-pv">
      本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=65888432";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
