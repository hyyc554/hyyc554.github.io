---
title: 《Redis in action》读书笔记（三）
tags:
 - Redis
---





## 4.3 处理系统故障

即使软件和硬件的设计完美无瑕，我们还是无法阻止停电、发电机宕机、备用电池电量耗尽的情况。

![](https://ws1.sinaimg.cn/large/d126accegy1fz0q636ehuj21c00uj472.jpg)

<!--more-->

### 4.3.1 验证快照文件和AOF文件

命令：

`redis-check-aof`

`redis-check-dump`

AOF文件的修复步骤：

- 扫描给定的AOF文件
- 寻找不正确或是不完整的命令
- 发现错误、不完整命令后，删除之后左右命令，留下正确的命令

快照无法修复

在恢复数据时，需要做验证（SHA1或SHA26）

### 4.3.2 更换故障主服务器

服务器A——主服务器——故障

服务器B——从服务器——正常

服务器C——备胎——活跃

解决方案：

- B执行SAVE，创建快照
- B将快照发给备胎C
- 备胎服务器C运行Redis
- B成为昔日备胎C的从服务器



